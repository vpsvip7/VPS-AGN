#!/bin/bash

        # Colors
        green="\e[38;5;82m"
        red="\e[38;5;196m"
        neutral="\e[0m"
        orange="\e[38;5;130m"
        blue="\e[38;5;39m"
        yellow="\e[38;5;226m"
        purple="\e[38;5;141m"
        bold_white="\e[1;37m"
        reset="\e[0m"
        pink="\e[38;5;205m"

        print_rainbow() {
            local text="$1"
            local length=${#text}
            local start_color=(0 5 0)
            local mid_color=(0 200 0)
            local end_color=(0 5 0)

            for ((i = 0; i < length; i++)); do
                local progress=$((i * 100 / (length - 1)))

                if [ $progress -lt 50 ]; then
                    local factor=$((progress * 2))
                    r=$(( (start_color[0] * (100 - factor) + mid_color[0] * factor) / 100 ))
                    g=$(( (start_color[1] * (100 - factor) + mid_color[1] * factor) / 100 ))
                    b=$(( (start_color[2] * (100 - factor) + mid_color[2] * factor) / 100 ))
                else
                    local factor=$(((progress - 50) * 2))
                    r=$(( (mid_color[0] * (100 - factor) + end_color[0] * factor) / 100 ))
                    g=$(( (mid_color[1] * (100 - factor) + end_color[1] * factor) / 100 ))
                    b=$(( (mid_color[2] * (100 - factor) + end_color[2] * factor) / 100 ))
                fi

                printf "\e[38;2;%d;%d;%dm%s" "$r" "$g" "$b" "${text:$i:1}"
            done
            echo -e "$reset" # Reset color at the end
        }

        print_names() {
            local text="$1"
            local length=${#text}
            local start_color=(255 165 0)  # Orange
            local mid_color=(255 69 0)     # Red-orange
            local end_color=(255 165 0)    # Orange

            for ((i = 0; i < length; i++)); do
                local progress=$((i * 100 / (length - 1)))

                if [ $progress -lt 50 ]; then
                    local factor=$((progress * 2))
                    r=$(( (start_color[0] * (100 - factor) + mid_color[0] * factor) / 100 ))
                    g=$(( (start_color[1] * (100 - factor) + mid_color[1] * factor) / 100 ))
                    b=$(( (start_color[2] * (100 - factor) + mid_color[2] * factor) / 100 ))
                else
                    local factor=$(((progress - 50) * 2))
                    r=$(( (mid_color[0] * (100 - factor) + end_color[0] * factor) / 100 ))
                    g=$(( (mid_color[1] * (100 - factor) + end_color[1] * factor) / 100 ))
                    b=$(( (mid_color[2] * (100 - factor) + end_color[2] * factor) / 100 ))
                fi

                printf "\e[38;2;%d;%d;%dm%s" "$r" "$g" "$b" "${text:$i:1}"
            done
            echo -e "$reset" # Reset color at the end
        }
        # Function to count accounts
        count_accounts() {
            if [ ! -e "/etc/xray/$1/.$1.db" ]; then
                mkdir -p "/etc/xray/$1"
                touch "/etc/xray/$1/.$1.db"
            fi

            accounts=$(cat "/etc/xray/$1/.$1.db")
            if [[ $accounts = "" ]]; then
                echo "0"
            else
                cat "/etc/xray/$1/.$1.db" | grep "###" | wc -l
            fi
        }

        # Count accounts
        vm=$(count_accounts "vmess")
        vl=$(count_accounts "vless")
        tr=$(count_accounts "trojan")
        ss=$(count_accounts "shadowsocks")
        ssh=$(cat "/etc/ssh/.ssh.db" | grep "###" | wc -l)

display_menu() {
    clear
    # Header
    echo -e "\e[38;5;45m╔══════════════════════════════════════════════════╗"
    echo -e "║             \e[38;5;220mOSPROJECT VPN AUTOSCRIPT\e[38;5;45m             ║"
    echo -e "╚══════════════════════════════════════════════════╝\e[0m"

    # System Information
    echo -e "\e[38;5;46m┌──────────────[ SYSTEM INFORMATION ]──────────────┐"
    system_name=$(grep -w PRETTY_NAME /etc/os-release | cut -d '=' -f2 | tr -d '"')
    echo -e "│   \e[38;5;226mOS          : \e[0m$system_name"
    total_ram_kb=$(awk '/MemTotal/ {print $2}' /proc/meminfo)
    available_ram_kb=$(awk '/MemAvailable/ {print $2}' /proc/meminfo)
    if [[ "$total_ram_kb" && "$available_ram_kb" ]]; then
        total_ram_gb=$(awk "BEGIN {printf \"%.2f\", $total_ram_kb / 1024 / 1024}")
        used_ram_kb=$((total_ram_kb - available_ram_kb))
        used_ram_gb=$(awk "BEGIN {printf \"%.2f\", $used_ram_kb / 1024 / 1024}")
        echo -e "│   \e[38;5;226mRAM         : \e[0m${used_ram_gb}GB / ${total_ram_gb}GB"
    else
        echo -e "│   \e[38;5;226mRAM         : \e[0mN/A"
    fi
    echo -e "│   \e[38;5;226mUPTIME      : \e[0m$(uptime -p | cut -d ' ' -f2-)"
    echo -e "│   \e[38;5;226mCPU Cores   : \e[0m$(nproc)"
    echo -e "│   \e[38;5;226mIP Address  : \e[0m$(wget -qO- ipv4.icanhazip.com 2>/dev/null || echo 'Unavailable')"
    echo -e "│   \e[38;5;226mISP         : \e[0m$(cat /etc/xray/isp 2>/dev/null || echo 'Unknown')"
    echo -e "│   \e[38;5;226mDomain      : \e[0m$(cat /etc/xray/domain 2>/dev/null || echo 'No domain registered')"
#    echo -e "│   \e[38;5;226mNS Domain   : \e[0m$(cat /etc/xray/dns 2>/dev/null || echo 'No NS registered')"
    echo -e "└──────────────────────────────────────────────────┘"

    # Account Information
    echo -e "\e[38;5;51m┌──────────────[ ACCOUNT INFORMATION ]─────────────┐"
    echo -e "│   \e[38;5;208mSSH/OVPN    : \e[0m$ssh ACCOUNT"
    echo -e "│   \e[38;5;208mVMESS       : \e[0m$vm ACCOUNT"
    echo -e "│   \e[38;5;208mVLESS       : \e[0m$vl ACCOUNT"
    echo -e "│   \e[38;5;208mTROJAN      : \e[0m$tr ACCOUNT"
    echo -e "│   \e[38;5;208mSHADOWSOCKS : \e[0m$ss ACCOUNT"
    echo -e "└──────────────────────────────────────────────────┘"

    # Script Information
    echo -e "\e[38;5;81m┌───────────────[ SCRIPT INFORMATION ]─────────────┐"
    echo -e "│   \e[38;5;150mUser Key    : \e[0m$(cat /root/.key || echo 'Unavailable')"
    echo -e "│   \e[38;5;150mChannel     : \e[0m@osproject_backend"
    echo -e "└──────────────────────────────────────────────────┘"

    # Menu
    echo -e "\e[38;5;33m┌───────────────────[ MAIN MENU ]──────────────────┐"
    echo -e "│   \e[38;5;226m1.\e[0m Manage SSH/OVPN      \e[38;5;226m4.\e[0m Manage Trojan"
    echo -e "│   \e[38;5;226m2.\e[0m Manage VMESS         \e[38;5;226m5.\e[0m Manage Shadowsocks"
    echo -e "│   \e[38;5;226m3.\e[0m Manage VLESS         \e[38;5;226m6.\e[0m Other Settings"
    echo -e "└──────────────────────────────────────────────────┘"

    # Prompt
    echo -e "\e[38;5;220m╔══════════════════════════════════════════════════╗"
    read -p "║ Select an option (1-6) or type 'x' to exit: " choice
    echo -e "╚══════════════════════════════════════════════════╝"


            case $choice in
                1) menussh ;;
                2) menuvmess ;;
                3) menuvless ;;
                4) menutrojan ;;
                5) menushadowsocks ;;
                6) menusetting ;;
                x | X)
                    echo -e ""
                    echo -e "   ${green}Thank you for using our services.${neutral}"
                    exit 0
                    ;;
                *)
                    echo -e "   ${red}Invalid choice. Please try again.${neutral}"
                    sleep 2
                    display_menu
                    ;;
            esac
        }

        display_menu
